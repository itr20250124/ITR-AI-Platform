# æ¸¬è©¦æ–‡æª”

æœ¬æ–‡æª”æè¿°äº†å¤šåŠŸèƒ½AIå¹³å°çš„æ¸¬è©¦ç­–ç•¥ã€æ¸¬è©¦çµæ§‹å’Œå¦‚ä½•é‹è¡Œæ¸¬è©¦ã€‚

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦½

æˆ‘å€‘çš„æ¸¬è©¦ç­–ç•¥åŒ…æ‹¬ä¸‰å€‹å±¤æ¬¡ï¼š

1. **å–®å…ƒæ¸¬è©¦** - æ¸¬è©¦å€‹åˆ¥å‡½æ•¸å’Œçµ„ä»¶
2. **æ•´åˆæ¸¬è©¦** - æ¸¬è©¦APIç«¯é»å’Œæœå‹™æ•´åˆ
3. **ç«¯åˆ°ç«¯æ¸¬è©¦** - æ¸¬è©¦å®Œæ•´çš„ç”¨æˆ¶å·¥ä½œæµç¨‹

## ğŸ—ï¸ æ¸¬è©¦æ¶æ§‹

### å¾Œç«¯æ¸¬è©¦çµæ§‹
```
backend/src/
â”œâ”€â”€ __tests__/
â”‚   â”œâ”€â”€ setup.ts                    # æ¸¬è©¦ç’°å¢ƒè¨­ç½®
â”‚   â””â”€â”€ imageGeneration.e2e.test.ts # ç«¯åˆ°ç«¯æ¸¬è©¦
â”œâ”€â”€ controllers/__tests__/
â”‚   â””â”€â”€ aiController.test.ts        # æ§åˆ¶å™¨å–®å…ƒæ¸¬è©¦
â”œâ”€â”€ services/ai/providers/__tests__/
â”‚   â””â”€â”€ OpenAIImageService.test.ts  # AIæœå‹™å–®å…ƒæ¸¬è©¦
â””â”€â”€ routes/__tests__/
    â””â”€â”€ imageRoutes.test.ts         # è·¯ç”±æ•´åˆæ¸¬è©¦
```

### å‰ç«¯æ¸¬è©¦çµæ§‹
```
frontend/src/
â”œâ”€â”€ __tests__/
â”‚   â””â”€â”€ setup.ts                    # æ¸¬è©¦ç’°å¢ƒè¨­ç½®
â”œâ”€â”€ services/__tests__/
â”‚   â””â”€â”€ imageService.test.ts        # æœå‹™å–®å…ƒæ¸¬è©¦
â””â”€â”€ components/image/__tests__/
    â”œâ”€â”€ ImageGenerator.test.tsx     # çµ„ä»¶å–®å…ƒæ¸¬è©¦
    â””â”€â”€ ImagePreview.test.tsx       # çµ„ä»¶å–®å…ƒæ¸¬è©¦
```

## ğŸ§ª æ¸¬è©¦é¡å‹

### 1. å–®å…ƒæ¸¬è©¦

#### å¾Œç«¯å–®å…ƒæ¸¬è©¦
- **æ§åˆ¶å™¨æ¸¬è©¦**: æ¸¬è©¦APIæ§åˆ¶å™¨çš„é‚è¼¯å’ŒéŒ¯èª¤è™•ç†
- **æœå‹™æ¸¬è©¦**: æ¸¬è©¦AIæœå‹™çš„åŠŸèƒ½å’Œåƒæ•¸é©—è­‰
- **å·¥å…·å‡½æ•¸æ¸¬è©¦**: æ¸¬è©¦è¼”åŠ©å‡½æ•¸å’Œå·¥å…·é¡

#### å‰ç«¯å–®å…ƒæ¸¬è©¦
- **çµ„ä»¶æ¸¬è©¦**: æ¸¬è©¦Reactçµ„ä»¶çš„æ¸²æŸ“å’Œäº¤äº’
- **æœå‹™æ¸¬è©¦**: æ¸¬è©¦å‰ç«¯æœå‹™é¡çš„APIèª¿ç”¨
- **å·¥å…·å‡½æ•¸æ¸¬è©¦**: æ¸¬è©¦è¼”åŠ©å‡½æ•¸å’Œå·¥å…·é¡

### 2. æ•´åˆæ¸¬è©¦

- **APIç«¯é»æ¸¬è©¦**: æ¸¬è©¦å®Œæ•´çš„HTTPè«‹æ±‚/éŸ¿æ‡‰æµç¨‹
- **è³‡æ–™åº«æ•´åˆ**: æ¸¬è©¦èˆ‡è³‡æ–™åº«çš„äº¤äº’
- **å¤–éƒ¨æœå‹™æ•´åˆ**: æ¸¬è©¦èˆ‡AIæœå‹™çš„æ•´åˆï¼ˆä½¿ç”¨æ¨¡æ“¬ï¼‰

### 3. ç«¯åˆ°ç«¯æ¸¬è©¦

- **å®Œæ•´å·¥ä½œæµç¨‹**: æ¸¬è©¦å¾ç”¨æˆ¶è¼¸å…¥åˆ°æœ€çµ‚çµæœçš„å®Œæ•´æµç¨‹
- **éŒ¯èª¤è™•ç†**: æ¸¬è©¦å„ç¨®éŒ¯èª¤æƒ…æ³çš„è™•ç†
- **æ€§èƒ½æ¸¬è©¦**: æ¸¬è©¦ç³»çµ±åœ¨è² è¼‰ä¸‹çš„è¡¨ç¾

## ğŸš€ é‹è¡Œæ¸¬è©¦

### å¿«é€Ÿé–‹å§‹

ä½¿ç”¨æˆ‘å€‘æä¾›çš„æ¸¬è©¦è…³æœ¬ï¼š

```bash
# Linux/Mac
./scripts/run-tests.sh

# Windows
scripts\run-tests.bat
```

### æ‰‹å‹•é‹è¡Œ

#### å¾Œç«¯æ¸¬è©¦
```bash
cd backend

# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm test

# ç›£è¦–æ¨¡å¼
npm run test:watch

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage

# åªé‹è¡Œç«¯åˆ°ç«¯æ¸¬è©¦
npm run test:e2e
```

#### å‰ç«¯æ¸¬è©¦
```bash
cd frontend

# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm test

# ç›£è¦–æ¨¡å¼
npm run test:watch

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage

# åªé‹è¡ŒUIçµ„ä»¶æ¸¬è©¦
npm run test:ui
```

## ğŸ“Š æ¸¬è©¦è¦†è“‹ç‡

æˆ‘å€‘çš„ç›®æ¨™æ˜¯é”åˆ°ä»¥ä¸‹æ¸¬è©¦è¦†è“‹ç‡ï¼š

- **èªå¥è¦†è“‹ç‡**: > 80%
- **åˆ†æ”¯è¦†è“‹ç‡**: > 75%
- **å‡½æ•¸è¦†è“‹ç‡**: > 85%
- **è¡Œè¦†è“‹ç‡**: > 80%

### æŸ¥çœ‹è¦†è“‹ç‡å ±å‘Š

é‹è¡Œæ¸¬è©¦å¾Œï¼Œå¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æŸ¥çœ‹è©³ç´°çš„è¦†è“‹ç‡å ±å‘Šï¼š

- å¾Œç«¯: `backend/coverage/lcov-report/index.html`
- å‰ç«¯: `frontend/coverage/lcov-report/index.html`

## ğŸ”§ æ¸¬è©¦é…ç½®

### Jest é…ç½®

#### å¾Œç«¯ (backend/jest.config.js)
```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  setupFilesAfterEnv: ['<rootDir>/src/__tests__/setup.ts'],
  collectCoverageFrom: [
    'src/**/*.ts',
    '!src/**/*.d.ts',
    '!src/**/__tests__/**',
  ],
};
```

#### å‰ç«¯ (frontend/jest.config.js)
```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/__tests__/setup.ts'],
  moduleNameMapping: {
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
  },
};
```

## ğŸ¯ æ¸¬è©¦æœ€ä½³å¯¦è¸

### 1. æ¸¬è©¦å‘½å
- ä½¿ç”¨æè¿°æ€§çš„æ¸¬è©¦åç¨±
- éµå¾ª "should [expected behavior] when [condition]" æ ¼å¼
- ä½¿ç”¨ä¸­æ–‡æè¿°ä»¥æé«˜å¯è®€æ€§

### 2. æ¸¬è©¦çµæ§‹
- ä½¿ç”¨ AAA æ¨¡å¼ (Arrange, Act, Assert)
- æ¯å€‹æ¸¬è©¦åªæ¸¬è©¦ä¸€å€‹åŠŸèƒ½é»
- ä¿æŒæ¸¬è©¦çš„ç¨ç«‹æ€§

### 3. æ¨¡æ“¬ (Mocking)
- æ¨¡æ“¬å¤–éƒ¨ä¾è³´ï¼ˆAPIã€è³‡æ–™åº«ç­‰ï¼‰
- ä½¿ç”¨ Jest çš„æ¨¡æ“¬åŠŸèƒ½
- é¿å…æ¸¬è©¦ä¸­çš„çœŸå¯¦APIèª¿ç”¨

### 4. æ¸¬è©¦æ•¸æ“š
- ä½¿ç”¨å·¥å» å‡½æ•¸å‰µå»ºæ¸¬è©¦æ•¸æ“š
- ä¿æŒæ¸¬è©¦æ•¸æ“šçš„ç°¡æ½”æ€§
- é¿å…ç¡¬ç·¨ç¢¼çš„æ¸¬è©¦æ•¸æ“š

## ğŸ› èª¿è©¦æ¸¬è©¦

### å¸¸è¦‹å•é¡Œ

1. **æ¸¬è©¦è¶…æ™‚**
   - å¢åŠ æ¸¬è©¦è¶…æ™‚æ™‚é–“
   - æª¢æŸ¥ç•°æ­¥æ“ä½œæ˜¯å¦æ­£ç¢ºè™•ç†

2. **æ¨¡æ“¬ä¸å·¥ä½œ**
   - ç¢ºä¿æ¨¡æ“¬åœ¨æ­£ç¢ºçš„ä½ç½®
   - æª¢æŸ¥æ¨¡æ“¬çš„å°å…¥è·¯å¾‘

3. **DOM ç›¸é—œéŒ¯èª¤**
   - ç¢ºä¿ä½¿ç”¨ jsdom ç’°å¢ƒ
   - æª¢æŸ¥æ¸¬è©¦è¨­ç½®æ–‡ä»¶

### èª¿è©¦æŠ€å·§

```javascript
// åœ¨æ¸¬è©¦ä¸­æ·»åŠ èª¿è©¦ä¿¡æ¯
console.log('Debug info:', someVariable);

// ä½¿ç”¨ Jest çš„èª¿è©¦æ¨¡å¼
npm test -- --verbose

// é‹è¡Œç‰¹å®šæ¸¬è©¦æ–‡ä»¶
npm test -- ImageGenerator.test.tsx
```

## ğŸ“ˆ æŒçºŒæ•´åˆ

### GitHub Actions

æˆ‘å€‘ä½¿ç”¨ GitHub Actions é€²è¡ŒæŒçºŒæ•´åˆï¼š

```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm ci
      - run: npm test
      - run: npm run test:coverage
```

### æ¸¬è©¦å ±å‘Š

- æ¸¬è©¦çµæœæœƒè‡ªå‹•ä¸Šå‚³åˆ°CI/CDå¹³å°
- è¦†è“‹ç‡å ±å‘Šæœƒç”Ÿæˆä¸¦å­˜æª”
- å¤±æ•—çš„æ¸¬è©¦æœƒé˜»æ­¢éƒ¨ç½²

## ğŸ”„ æ¸¬è©¦ç¶­è­·

### å®šæœŸä»»å‹™

1. **æ›´æ–°æ¸¬è©¦ä¾è³´**: å®šæœŸæ›´æ–°æ¸¬è©¦æ¡†æ¶å’Œå·¥å…·
2. **å¯©æŸ¥æ¸¬è©¦è¦†è“‹ç‡**: ç¢ºä¿æ–°åŠŸèƒ½æœ‰é©ç•¶çš„æ¸¬è©¦
3. **æ¸…ç†éæ™‚æ¸¬è©¦**: ç§»é™¤ä¸å†éœ€è¦çš„æ¸¬è©¦
4. **æ€§èƒ½å„ªåŒ–**: å„ªåŒ–æ…¢é€Ÿæ¸¬è©¦

### æ¸¬è©¦é‡æ§‹

ç•¶ä»£ç¢¼é‡æ§‹æ™‚ï¼Œç›¸æ‡‰åœ°æ›´æ–°æ¸¬è©¦ï¼š

1. ä¿æŒæ¸¬è©¦èˆ‡å¯¦ç¾çš„åŒæ­¥
2. é‡æ§‹é‡è¤‡çš„æ¸¬è©¦ä»£ç¢¼
3. æ”¹é€²æ¸¬è©¦çš„å¯è®€æ€§å’Œç¶­è­·æ€§

## ğŸ“š ç›¸é—œè³‡æº

- [Jest å®˜æ–¹æ–‡æª”](https://jestjs.io/docs/getting-started)
- [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)
- [Supertest æ–‡æª”](https://github.com/visionmedia/supertest)
- [æ¸¬è©¦æœ€ä½³å¯¦è¸](https://github.com/goldbergyoni/javascript-testing-best-practices)

---

## ğŸ¤ è²¢ç»æ¸¬è©¦

å¦‚æœæ‚¨æƒ³ç‚ºæ¸¬è©¦åšå‡ºè²¢ç»ï¼š

1. ç‚ºæ–°åŠŸèƒ½ç·¨å¯«æ¸¬è©¦
2. æ”¹é€²ç¾æœ‰æ¸¬è©¦çš„è¦†è“‹ç‡
3. å ±å‘Šå’Œä¿®å¾©æ¸¬è©¦ä¸­çš„å•é¡Œ
4. æ”¹é€²æ¸¬è©¦æ–‡æª”

è¨˜ä½ï¼šå¥½çš„æ¸¬è©¦æ˜¯é«˜è³ªé‡è»Ÿä»¶çš„åŸºç¤ï¼ğŸ¯